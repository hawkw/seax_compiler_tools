<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `bytecode` mod in crate `seax_util`.">
    <meta name="keywords" content="rust, rustlang, rust-lang, bytecode">

    <title>seax_util::bytecode - Rust</title>

    <link rel="stylesheet" type="text/css" href="../../main.css">

    
    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <section class="sidebar">
        
        <p class='location'><a href='../index.html'>seax_util</a></p><script>window.sidebarCurrent = {name: 'bytecode', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script>
    </section>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content mod">
<h1 class='fqn'><span class='in-band'>Module <a href='../index.html'>seax_util</a>::<wbr><a class='mod' href=''>bytecode</a></span><span class='out-of-band'><span id='render-detail'>
            <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                [<span class='inner'>&#x2212;</span>]
            </a>
        </span><a id='src-5243' class='srclink' href='../../src/seax_util/bytecode/mod.rs.html#1-581' title='goto source code'>[src]</a></span></h1>
<div class='docblock'>
<h2 id="bytecode" class='section-header'><a
                           href="#bytecode">Bytecode</a></h2>
<p>Contains code for encoding and decoding SVM cells to and from bytecode.</p>

<h1 id="bytecode-1" class='section-header'><a
                           href="#bytecode-1">Bytecode</a></h1>
<p>This module contains functions for encoding and decoding Seax bytecode.</p>

<h1 id="seax-bytecode-format" class='section-header'><a
                           href="#seax-bytecode-format">Seax Bytecode Format</a></h1>
<p>Seax Bytecode Standard Revision 0, June 11th, 2015</p>

<h2 id="i:-the-preamble" class='section-header'><a
                           href="#i:-the-preamble">I: The preamble</a></h2>
<p>All Seax Bytecode files begin with a preamble. This preamble consists of the following:</p>

<ol>
<li>The identifying bytes 0x5ECD. These bytes, chosen based on a poorly-advised attempt to
spell out the abbreviation SECD in hexadecimal, identify the file as a Seax bytecode file.</li>
<li>A 16-bit unsigned integer that represents the version of the Seax bytecode format that the
file was encoded with. This number is used to determine how the remainder of the file should
be decoded. This document is Revision 0 of the Seax Bytecode format, so the version
should be 0x0000.</li>
</ol>

<p>Future revisions of this standard will allow additional metadata, such as the author&#39;s
cryptographic signature, checksums for ensuring the executable&#39;s integrity, and directives to
the virtual machine, to be placed in the preamble as well.</p>

<h2 id="ii:-instructions" class='section-header'><a
                           href="#ii:-instructions">II: Instructions</a></h2>
<p>All Seax VM instructions are encoded using single byes. The Seax opcodes occupy the
space 0x00 to 0x30, with the bytes 0x1D through 0x3F being reserved for future use.</p>

<p>The following table shows all of the currently available SVM opcodes.</p>

<p>| Value | Name          | Description
+-------+---------------+--------------------------------------------------------------------
  0x00  | NIL           | Pushes an empty list (nil) onto <code>$s</code>.
  0x01  | LD (a . b)    | Pushes the variable at <code>$e[a][b]</code> onto the stack.
  0x02  | LDF f         | Constructs a closure from the list <code>f</code> and the current environment,
                          and pushes it to <code>$s</code>.
  0x03  | AP c          | Applies the function closure <code>c</code>.
  0x04  | APCC c        | Applies the function closure <code>c</code> and pushes a continuation on <code>$d</code>.
  0x05  | JOIN          | Returns control to the calling scope at the end of a <code>SEL</code>.
  0x06  | RAP c         | Applies the recursive closure <code>c</code>.
  0x07  | RET           | Returns control from a function to the calling function.
  0x08  | DUM           | Pushes a dummy environment to <code>$e</code> for applying a recursive function.
  0x09  | SEL a         | Applies the first list of instructions on <code>$c</code> if <code>a</code> is non-nil,
                          or the second list if it is nil.
  0x0A  | ADD a b       |
  0x0B  | SUB a b       |
  0x0C  | MUL a b       |
  0x0D  | DIV a b       |
  0x0E  | MOD a b       |
  0x0F  | FDIV a b      |
  0x10  | EQ a b        |
  0x11  | GT a b        |
  0x12  | GTE a b       |
  0x13  | LT a b        |
  0x14  | LTE a b       |
  0x15  | ATOM a        |
  0x16  | NULL a        |
  0x17  | READC         |
  0x18  | WRITEC        |
  0x19  | CONS a b      |
  0x1A  | CAR (a . b)   |
  0x1B  | CDR (a . b)   |
  0x1C  | LDC           |
  0x1D  | STOP          |
  0x1E  | reserved      |
        |     ...       |
  0x30  | reserved      |</p>

<h2 id="iii:-constants" class='section-header'><a
                           href="#iii:-constants">III: Constants</a></h2>
<p>Constants are identified by a preceeding constant-identification byte. Constant-identification
bytes comprise the range of bytes between 0xC0 and 0xCF, inclusive, and the NIL byte, 0x00.</p>

<p>Constants are expected in two places: following either an LDC (LoaD Constant) instruction,
or following an instruction that expects a list on $c, such as a SEL instruction.</p>

<ol>
<li><p>CONS Cells (0xC0)</p>

<p>0xC0 identifies the beginning of a CONS cell constant. It may then be followed by the
identification byte denoting any other constant, which will be interpreted as the CAR part
of the CONS cell. This is followed by the actual bytecode data for the CAR part of the CONS
cell, which is of the length specified by the type identified by the identification byte.</p>

<p>After the constant for the CAR part, there must be an additional identification byte, which
identifies the type of the CONS cell&#39;s CDR part. Unlike the CAR part, this may be any
constant type, including another CONS cell. This identification byte is again followed by
the bytecode for the data stored in the CONS cell&#39;s CDR part, whose length is determined
by the type identified by the identification byte.</p>

<p>Alternatively, the CAR or CDR parts of a CONS cell may also contain a Seax instruction. In
such a case, the identification byte is replaced by that instruction&#39;s opcode. The opcode
comprises the entirity of the CAR or CDR part, and any further data is interpreted as
appropriate (i.e., if the opcode is the CAR part, another opcode or identifying byte will
be expected, while if the opcode is in the CDR part, a new instruction or constant will
be expected.)</p></li>
<li><p>Atom constants (0xC1 ... 0xCF)</p>

<p>Any constants that are not CONS cells are atom constants. Atom constants are identified by
bytes in the range between 0xC1 and 0xCF, inclusive. Currently, 0xC1, 0xC2, 0xC3, and 0xC4
identify extant atom types, while 0xC5 ... 0xCE are reserved for future use.</p>

<p>Once an atom constant identifying byte is read, the bytes that follow it will be read as
that type of atom. The number of bytes read depends on the length of the atom type, which is
determined using the identifying bytes. The following identifying bytes correspond to the
following atom types:</p></li>
</ol>

<ul>
<li>0xC1: uint atom (64-bit unsigned integer)</li>
<li>0xC2: sint atom (64-bit signed integer)</li>
<li>0xC3: char atom (32-bit Unicode scalar value)</li>
<li><p>0xC4: float atom (64-bit double-precision floating point number</p>

<p>If additional primitive data types are added to the Seax VM, the bytes 0xC5 to 0xCF will
be used to identify those types.</p>

<p>Note that the type tag identifying a constant may be extracted by byte-masking the
identifying byte with the number 0x0F.</p></li>
</ul>
</div><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table>
                    <tr class=' module-item'>
                        <td><a class='struct' href='struct.Decoder.html'
                               title='seax_util::bytecode::Decoder'>Decoder</a></td>
                        <td class='docblock short'>
                             
                        </td>
                    </tr>
                </table><h2 id='constants' class='section-header'><a href="#constants">Constants</a></h2>
<table>
                    <tr class=' module-item'>
                        <td><a class='constant' href='constant.IDENT_BYTES.html'
                               title='seax_util::bytecode::IDENT_BYTES'>IDENT_BYTES</a></td>
                        <td class='docblock short'>
                             <p>Identifying bytes for a Seax bytecode file</p>

                        </td>
                    </tr>
                
                    <tr class=' module-item'>
                        <td><a class='constant' href='constant.VERSION.html'
                               title='seax_util::bytecode::VERSION'>VERSION</a></td>
                        <td class='docblock short'>
                             <p>Identifying bytes for this version of the Seax bytecode standard.</p>

                        </td>
                    </tr>
                </table><h2 id='traits' class='section-header'><a href="#traits">Traits</a></h2>
<table>
                    <tr class=' module-item'>
                        <td><a class='trait' href='trait.Encode.html'
                               title='seax_util::bytecode::Encode'>Encode</a></td>
                        <td class='docblock short'>
                             <p>Trait for an object that can be encoded to Seax bytecode.</p>

                        </td>
                    </tr>
                </table><h2 id='functions' class='section-header'><a href="#functions">Functions</a></h2>
<table>
                    <tr class=' module-item'>
                        <td><a class='fn' href='fn.decode_program.html'
                               title='seax_util::bytecode::decode_program'>decode_program</a></td>
                        <td class='docblock short'>
                             <p>Decode a whole program</p>

                        </td>
                    </tr>
                </table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <div id="help" class="hidden">
        <div class="shortcuts">
            <h1>Keyboard Shortcuts</h1>
            <dl>
                <dt>?</dt>
                <dd>Show this help dialog</dd>
                <dt>S</dt>
                <dd>Focus the search field</dd>
                <dt>&larrb;</dt>
                <dd>Move up in search results</dd>
                <dt>&rarrb;</dt>
                <dd>Move down in search results</dd>
                <dt>&#9166;</dt>
                <dd>Go to active search result</dd>
            </dl>
        </div>
        <div class="infos">
            <h1>Search Tricks</h1>
            <p>
                Prefix searches with a type followed by a colon (e.g.
                <code>fn:</code>) to restrict the search to a given type.
            </p>
            <p>
                Accepted types are: <code>fn</code>, <code>mod</code>,
                <code>struct</code>, <code>enum</code>,
                <code>trait</code>, <code>typedef</code> (or
                <code>tdef</code>).
            </p>
            <p>
                Search functions by type signature (e.g.
                <code>vec -> usize</code>)
            </p>
        </div>
    </div>

    

    <script>
        window.rootPath = "../../";
        window.currentCrate = "seax_util";
        window.playgroundUrl = "";
    </script>
    <script src="../../jquery.js"></script>
    <script src="../../main.js"></script>
    
    <script async src="../../search-index.js"></script>
</body>
</html>